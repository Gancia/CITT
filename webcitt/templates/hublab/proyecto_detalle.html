{% extends 'base.html' %}
{% load static %}

{% block title %}{{ proyecto.nombre }} - HubLab{% endblock %}

{% block content %}
<div class="row form-login" style="margin: -20px -15px 20px; padding: 0;">
  <div class="col-12">
    <div class="mb-3">
      <h1>{{ proyecto.nombre }}</h1>
      <nav class="breadcrumb-container d-none d-sm-block d-lg-inline-block" aria-label="breadcrumb">
        <ol class="breadcrumb pt-0">
          <li class="breadcrumb-item">
            <a href="{% url 'uexperimentales' %}">HUBLAB</a>
          </li>
          <li class="breadcrumb-item active" aria-current="page">{{ proyecto.nombre }}</li>
        </ol>
      </nav>
    </div>
  </div>
</div>

<div class="row form-login" style="margin: -20px -15px 20px; padding: 0;">
  <div class="col-12 col-md-12 col-lg-9 col-xl-9">
    <div class="card mb-2">
      <div class="card-body" style="padding: 0.5rem;">
        <div class="card mb-1" style="padding: 5px;">
          <div class="card-headers glide gallery glide--ltr glide--carousel glide--swipeable">
            <ul class="nav" role="tablist" id="modulo-tabs">
              {% for modulo in modulos %}
              <li class="nav-item">
                <a class="nav-link btn btn-primary default {% if forloop.first %}active{% endif %}" 
                   data-toggle="tab" 
                   href="javascript:void(0);" 
                   data-modulo="{{ modulo }}" 
                   role="tab">
                  <i class="iconsminds-folder large-icon1 initial-height"></i>{{ modulo|capfirst }}
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>
        </div>

        <div id="dynamic-content" class="tab-content card mb-2" style="height: 630px; overflow: auto;">
          <p class="text-muted">Seleccione un módulo para ver su contenido.</p>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12 col-md-12 col-lg-3 col-xl-3">
    <div class="cards mb-2 form-login1">
      <div class="card-body">
        <h2 class="card-title">CATEGORÍAS</h2>
        <div id="accordion">
          {% for modulo in modulos %}
          <div class="modulo-carpeta-list" data-modulo="{{ modulo }}" style="{% if not forloop.first %}display:none;{% endif %}">
            {% for carpeta in proyecto.carpetas.all %}
              {% if carpeta.modulo == modulo %}
              <div>
                <button class="btn btn-link collapsed btn btn-warning default btn-block mb-2"
                  data-toggle="collapse" data-target="#collapseCarpeta{{ forloop.parentloop.counter }}_{{ forloop.counter }}"
                  aria-expanded="false" aria-controls="collapseCarpeta{{ forloop.parentloop.counter }}_{{ forloop.counter }}">
                  <i class="simple-icon-login"></i>
                  {{ carpeta.nombre }}
                </button>
                <div id="collapseCarpeta{{ forloop.parentloop.counter }}_{{ forloop.counter }}" class="collapse" data-parent="#accordion">
                  <div class="pb-1 mb-3 card" style="padding: 5px;">
                    <ul class="nav pb-1" role="tablist">
                      {% for recurso in carpeta.recursos.all %}
                      <li class="nav-item btn-block">
                        {% if recurso.archivo %}
                        <a class="nav-link btn btn-light default"
                          href="javascript:void(0);"
                          onclick="replaceContent('{{ recurso.archivo.url }}', '{{ recurso.archivo.name|lower }}')">
                          <i class="iconsminds-folder"></i>
                          {{ recurso.nombre }}
                        </a>
                        {% else %}
                        <span class="nav-link btn btn-light default text-muted">
                          <i class="iconsminds-folder"></i>
                          {{ recurso.nombre }}
                        </span>
                        {% endif %}
                      </li>
                      {% empty %}
                      <li class="nav-item btn-block">
                        <span class="text-muted">No hay recursos disponibles</span>
                      </li>
                      {% endfor %}
                    </ul>
                  </div>
                </div>
              </div>
              {% endif %}
            {% endfor %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('#modulo-tabs .nav-link').forEach(tab => {
    tab.addEventListener('click', function() {
      document.querySelectorAll('#modulo-tabs .nav-link').forEach(t => t.classList.remove('active'));
      this.classList.add('active');
      const modulo = this.getAttribute('data-modulo');
      document.querySelectorAll('.modulo-carpeta-list').forEach(list => {
        list.style.display = list.getAttribute('data-modulo') === modulo ? '' : 'none';
      });
    });
  });
</script>
{% endblock %}